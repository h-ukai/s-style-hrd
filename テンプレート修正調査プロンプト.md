# テンプレートマイグレーション: 反復調査

あなたは Google App Engine webapp2 から Flask へのテンプレートマイグレーションを設計するエキスパートです。
これから行うのは個々のファイルの修正方針の指示ではなく、個別の修正タスクが共有するべき共通ルールの抽出作業です。

## 実行環境
- **プロジェクトルート**: `C:\Users\hrsuk\prj\s-style-hrd`
- **テンプレートディレクトリ**: `C:\Users\hrsuk\prj\s-style-hrd\src\templates\`
- **状態ファイル**: `C:\Users\hrsuk\prj\s-style-hrd\TEMPLATE_MIGRATION_STATE.md`
- **ルールファイル**: `C:\Users\hrsuk\prj\s-style-hrd\TEMPLATE_MIGRATION_RULES.md`

## 反復調査でやること

### 1. 状態ファイルの確認
- `TEMPLATE_MIGRATION_STATE.md` を Read ツールで読み込む
- 「## 未調査テンプレート」セクションを確認

### 2. 調査対象の選定（最大10個）
リストの上から順に取得

### 3. テンプレートファイルの分析
選定したファイルを Read ツールで読み込み、以下を分析:

**a) テンプレートエンジン構文**
- webapp2構文 vs Jinja2構文の違い
- {% ifequal %} → {% if == %} 等の変換必要性
- テンプレート継承パターン

**b) パス参照パターン**
- 絶対パス形式の抽出（/js/, /css/, /img/, https://）
- 相対パス変換時の基準パス
- 外部ドメインへのリンク

**c) JavaScript/jQuery互換性**
- 廃止されたAPI（.live(), .browser等）の使用
- ブラウザ固有コード（IE専用等）
- 古いDOM API（document.all等）

**d) 外部ライブラリ依存**
- CDN/ローカルのライブラリ参照
- 古いプラグイン（thickbox等）

**e) Flask移行時の変更点**
- フォーム送信先（action属性）
- セッション変数の参照
- CSRF対策
- URL生成（url_for()検討）

### 4. マイグレーションルールの記録
`TEMPLATE_MIGRATION_RULES.md` に以下のみ記録:

**## 方針決定**（選択肢が複数ある場合のみ）
- 例: テンプレートエンジン選定、パス変換方針、jQuery方針

**## 大幅変更**（構造が大きく変わる箇所）
- 例: webapp2構文変換、パス変換、jQuery API変換

**## 統一仕様**（テンプレート間で共有すべき仕様）
- 例: 静的ファイル参照方法、継承構造、CSRF トークン配置

**## 懸念事項**（判断保留や要検討事項）
- 例: 古いライブラリ、大量変換が必要な箇所

### 5. 状態の更新
- 調査したファイルを「## 未調査テンプレート」から削除
- 「## 調査済みテンプレート」に追加
- フォルダごとにグループ化

## 記録ルール
- すべて箇条書き `-` で記述
- 選択理由は1行で簡潔に併記
- コード例は最小限（API名と変換前後のみ）
- 一般知識は記録しない（Jinja2の基本構文等）
- 懸念事項は積極的に記録
- 重複した内容は書き込まない

## 重要な制約
- 必ず Edit ツールでファイルを直接編集
- 完全なファイル内容を出力しない
- 1回の実行で最大10個まで